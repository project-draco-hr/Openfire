{
  boolean c2sConnection=(remoteServer == null);
  if (debug) {
    System.setProperty("javax.net.debug","all");
  }
  String algorithm=JiveGlobals.getProperty("xmpp.socket.ssl.algorithm","TLS");
  try {
    KeyStore ksKeys=SSLConfig.getKeyStore();
    String keypass=SSLConfig.getKeyPassword();
    KeyStore ksTrust=(c2sConnection ? SSLConfig.getc2sTrustStore() : SSLConfig.gets2sTrustStore());
    String trustpass=(c2sConnection ? SSLConfig.getc2sTrustPassword() : SSLConfig.gets2sTrustPassword());
    KeyManager[] km=SSLJiveKeyManagerFactory.getKeyManagers(ksKeys,keypass);
    TrustManager[] tm=SSLJiveTrustManagerFactory.getTrustManagers(ksTrust,trustpass);
    if (clientMode || needClientAuth) {
      if (c2sConnection) {
        tm=new TrustManager[]{new ClientTrustManager(ksTrust)};
      }
 else {
        tm=new TrustManager[]{new ServerTrustManager(remoteServer,ksTrust,connection)};
      }
    }
    SSLContext tlsContext=SSLContext.getInstance(algorithm);
    tlsContext.init(km,tm,null);
    tlsEngine=tlsContext.createSSLEngine();
    tlsEngine.setUseClientMode(clientMode);
    SSLSession sslSession=tlsEngine.getSession();
    netBuffSize=sslSession.getPacketBufferSize();
    appBuffSize=sslSession.getApplicationBufferSize();
  }
 catch (  KeyManagementException e) {
    Log.error("TLSHandler startup problem.\n" + "  SSLContext initialisation failed.",e);
  }
catch (  NoSuchAlgorithmException e) {
    Log.error("TLSHandler startup problem.\n" + "  The " + algorithm + " does not exist",e);
  }
catch (  IOException e) {
    Log.error("TLSHandler startup problem.\n" + "  the KeyStore or TrustStore does not exist",e);
  }
}
