def RegenerateAppendFlag(flag, values, predicate, env_name, options):
    "Regenerate a list of command line flags, for an option of action='append'.\n\n  The |env_name|, if given, is checked in the environment and used to generate\n  an initial list of options, then the options that were specified on the\n  command line (given in |values|) are appended.  This matches the handling of\n  environment variables and command line flags where command line flags override\n  the environment, while not requiring the environment to be set when the flags\n  are used again.\n  "
    flags = []
    if (options.use_environment and env_name):
        for flag_value in ShlexEnv(env_name):
            value = FormatOpt(flag, predicate(flag_value))
            if (value in flags):
                flags.remove(value)
            flags.append(value)
    if values:
        for flag_value in values:
            flags.append(FormatOpt(flag, predicate(flag_value)))
    return flags
