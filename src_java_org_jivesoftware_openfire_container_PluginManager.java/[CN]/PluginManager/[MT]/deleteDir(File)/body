{
  if (dir.isDirectory()) {
    String[] childDirs=dir.list();
    List<String> children=new ArrayList<>(Arrays.asList(childDirs));
    Collections.sort(children,new Comparator<String>(){
      @Override public int compare(      String o1,      String o2){
        if (o1.equals("lib")) {
          return -1;
        }
        if (o2.equals("lib")) {
          return 1;
        }
 else {
          return o1.compareTo(o2);
        }
      }
    }
);
    for (    String file : children) {
      boolean success=deleteDir(new File(dir,file));
      if (!success) {
        Log.debug("PluginManager: Plugin removal: could not delete: " + new File(dir,file));
        return false;
      }
    }
  }
  boolean deleted=!dir.exists() || dir.delete();
  if (deleted) {
    pluginFiles.remove(dir.getName());
  }
  return deleted;
}
