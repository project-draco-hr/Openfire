def _GetMSBuildPropertyGroup(spec, label, properties):
    'Returns a PropertyGroup definition for the specified properties.\n\n  Arguments:\n    spec: The target project dict.\n    label: An optional label for the PropertyGroup.\n    properties: The dictionary to be converted.  The key is the name of the\n        property.  The value is itself a dictionary; its key is the value and\n        the value a list of condition for which this value is true.\n  '
    group = ['PropertyGroup']
    if label:
        group.append({'Label': label, })
    num_configurations = len(spec['configurations'])

    def GetEdges(node):
        edges = set()
        for value in sorted(properties[node].keys()):
            edges.update(set([v for v in MSVS_VARIABLE_REFERENCE.findall(value) if ((v in properties) and (v != node))]))
        return edges
    properties_ordered = gyp.common.TopologicallySorted(properties.keys(), GetEdges)
    for name in reversed(properties_ordered):
        values = properties[name]
        for (value, conditions) in sorted(values.iteritems()):
            if (len(conditions) == num_configurations):
                group.append([name, value])
            else:
                for condition in conditions:
                    group.append([name, {'Condition': condition, }, value])
    return [group]
