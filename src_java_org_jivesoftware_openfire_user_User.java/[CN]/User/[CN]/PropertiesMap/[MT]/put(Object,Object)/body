{
  Map<String,Object> eventParams=new HashMap<String,Object>();
  Object answer;
  String keyString=(String)key;
synchronized (getName() + keyString.intern()) {
    if (properties.containsKey(keyString)) {
      String originalValue=properties.get(keyString);
      answer=properties.put(keyString,(String)value);
      updateProperty(keyString,(String)value);
      eventParams.put("type","propertyModified");
      eventParams.put("propertyKey",key);
      eventParams.put("originalValue",originalValue);
    }
 else {
      answer=properties.put(keyString,(String)value);
      insertProperty(keyString,(String)value);
      eventParams.put("type","propertyAdded");
      eventParams.put("propertyKey",key);
    }
  }
  UserEventDispatcher.dispatchEvent(User.this,UserEventDispatcher.EventType.user_modified,eventParams);
  return answer;
}
